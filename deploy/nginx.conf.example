# Example Nginx config for MangaVerse PWA (SPA + static assets)

server {
    # Change the port to 40141 as requested
    listen 40141;
    server_name manga.example.com;  # <- change to your subdomain

    root /var/www/mangaverse;       # <- change to your deploy path
    index index.html;

    # Serve the web app manifest with correct MIME
    location = /manifest.webmanifest {
        add_header Content-Type application/manifest+json;
        try_files $uri =404;
    }

    # Service Worker should not be hard-cached
    location = /sw.js {
        add_header Cache-Control no-cache;
        try_files $uri =404;
    }

    # Icons and other long-lived assets
    location /icons/ {
        expires 30d;
        add_header Cache-Control public;
        try_files $uri =404;
    }

    # SPA routing: send unknown requests to index.html
    location / {
        try_files $uri $uri/ /index.html;
    }

    # Optional: gzip for text assets
    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss image/svg+xml;
}

# OPTIONAL: HTTPS on port 40141 (requires certificate files)
# You can obtain a certificate via your hosting panel or DNS-01 challenge,
# then point ssl_certificate and ssl_certificate_key to the files below.
# Note: Let's Encrypt HTTP-01 requires port 80; if 80 is busy, use DNS-01
# or terminate TLS on a standard 443 vhost and reverse proxy to 40141.

# server {
#     listen 40141 ssl http2;
#     server_name manga.example.com;
#
#     ssl_certificate     /etc/letsencrypt/live/manga.example.com/fullchain.pem;
#     ssl_certificate_key /etc/letsencrypt/live/manga.example.com/privkey.pem;
#
#     root /var/www/mangaverse;
#     index index.html;
#
#     location = /manifest.webmanifest {
#         add_header Content-Type application/manifest+json;
#         try_files $uri =404;
#     }
#     location = /sw.js {
#         add_header Cache-Control no-cache;
#         try_files $uri =404;
#     }
#     location /icons/ {
#         expires 30d;
#         add_header Cache-Control public;
#         try_files $uri =404;
#     }
#     location / {
#         try_files $uri $uri/ /index.html;
#     }
#     gzip on;
#     gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss image/svg+xml;
# }

