# Serve the static PWA on port 40141 (HTTP only)
# Root points to /mangaverse as requested

server {
    listen 40141;
    listen [::]:40141;
    server_name mangaverse.tojest.dev;  # not strictly required for non-443, but fine to set

    root /mangaverse;   # put the contents of `dist/` here
    index index.html;

    # Manifest with correct MIME
    location = /manifest.webmanifest {
        add_header Content-Type application/manifest+json;
        try_files $uri =404;
    }

    # Service Worker should not be hard-cached
    location = /sw.js {
        add_header Cache-Control no-cache;
        try_files $uri =404;
    }

    # Icons and other static assets
    location /icons/ {
        expires 30d;
        add_header Cache-Control public;
        try_files $uri =404;
    }

    # SPA routing
    location / {
        try_files $uri $uri/ /index.html;
    }

    # Optional gzip
    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss image/svg+xml;
}
